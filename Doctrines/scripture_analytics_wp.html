<!-- WordPress-Ready Scripture Analytics -->
<style>
.analytics-wrapper {
    font-family: Georgia, serif;
    line-height: 1.6;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    border-radius: 8px;
}
.analytics-wrapper h2 {
    color: #ffffff;
    text-align: center;
    font-size: 2.5em;
    padding: 1em 0;
    margin: 0 0 0.5em 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.analytics-wrapper .container {
    background: white;
    border-radius: 12px;
    padding: 2em;
    box-shadow: 0 12px 24px rgba(0,0,0,0.2);
}
.analytics-wrapper .stat-box {
    background: linear-gradient(to right, #e0f2fe, #dbeafe);
    border-left: 4px solid #3b82f6;
    padding: 1.5em;
    margin: 1em 0;
    border-radius: 8px;
}
.analytics-wrapper .stat-box h3 {
    color: #1e40af;
    margin-top: 0;
}
.analytics-wrapper .stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #2563eb;
    text-align: center;
    margin: 0.5em 0;
}
.analytics-wrapper table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
}
.analytics-wrapper th, .analytics-wrapper td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
}
.analytics-wrapper th {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    font-weight: bold;
}
.analytics-wrapper tr:nth-child(even) {
    background-color: #f9fafb;
}
.analytics-wrapper tr:hover {
    background-color: #eff6ff;
}
.analytics-wrapper .back-link {
    display: inline-block;
    margin-bottom: 1.5em;
    padding: 0.75em 1.5em;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border-radius: 8px;
    font-weight: bold;
    text-decoration: none;
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    transition: all 0.3s ease;
}
.analytics-wrapper .back-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
}
</style>

<div class="analytics-wrapper">
<h2>üìä Scripture Analytics Dashboard</h2>
<div class="container">
    <a href="https://intelligencereport.info/complete-library-of-christian-doctrine/" class="back-link">‚Üê Back to Doctrines Library</a>
    
    <div class="stat-box">
        <h3>Overview Statistics</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1em;">
            <div>
                <div class="stat-number">1490</div>
                <div style="text-align: center; color: #6b7280;">Total Scripture References</div>
            </div>
            <div>
                <div class="stat-number">35</div>
                <div style="text-align: center; color: #6b7280;">Unique Doctrines</div>
            </div>
            <div>
                <div class="stat-number">70</div>
                <div style="text-align: center; color: #6b7280;">Books Referenced</div>
            </div>
        </div>
    </div>
    
    <div class="stat-box">
        <h3>üìñ Most Cited Books</h3>
        <table>
            <tr><th>Rank</th><th>Book</th><th>References</th></tr>
            <tr><td>1</td><td>Rom</td><td>125</td></tr>
            <tr><td>2</td><td>John</td><td>92</td></tr>
            <tr><td>3</td><td>Eph</td><td>85</td></tr>
            <tr><td>4</td><td>Heb</td><td>72</td></tr>
            <tr><td>5</td><td>2 Cor</td><td>64</td></tr>
            <tr><td>6</td><td>1 Cor</td><td>60</td></tr>
            <tr><td>7</td><td>Ps</td><td>60</td></tr>
            <tr><td>8</td><td>1 John</td><td>51</td></tr>
            <tr><td>9</td><td>Matt</td><td>44</td></tr>
            <tr><td>10</td><td>Rev</td><td>42</td></tr>
            
        </table>
    </div>
    
    <div class="stat-box">
        <h3>üìù Doctrines with Most Scripture References</h3>
        <table>
            <tr><th>Rank</th><th>Doctrine</th><th>References</th></tr>
            <tr><td>1</td><td>Doctrine of Divine Essence</td><td>177</td></tr>
            <tr><td>2</td><td>Doctrine of Eternal Security</td><td>109</td></tr>
            <tr><td>3</td><td>Doctrine of the Heart</td><td>92</td></tr>
            <tr><td>4</td><td>Thirty-Nine Irrevocable Absolutes and One Revocable Absolute</td><td>90</td></tr>
            <tr><td>5</td><td>Doctrine of Witnessing</td><td>74</td></tr>
            <tr><td>6</td><td>Doctrine of Evil</td><td>70</td></tr>
            <tr><td>7</td><td>Doctrine of Happiness</td><td>60</td></tr>
            <tr><td>8</td><td>Doctrine of the Hypostatic Union</td><td>57</td></tr>
            <tr><td>9</td><td>Doctrine of the Levitical Priesthood</td><td>46</td></tr>
            <tr><td>10</td><td>Doctrine of the Ministry of the Holy Spirit</td><td>36</td></tr>
            
        </table>
    </div>
    
    <div class="stat-box">
        <h3>‚≠ê Most Referenced Verses</h3>
        <table>
            <tr><th>Rank</th><th>Verse</th><th>Times Used</th></tr>
            <tr><td>1</td><td>1 John 2:2</td><td>14</td></tr>
            <tr><td>2</td><td>Rom 3:25</td><td>10</td></tr>
            <tr><td>3</td><td>1 Cor 12:13</td><td>9</td></tr>
            <tr><td>4</td><td>1 John 1:9</td><td>9</td></tr>
            <tr><td>5</td><td>2 Cor 5:21</td><td>9</td></tr>
            <tr><td>6</td><td>John 3:16</td><td>7</td></tr>
            <tr><td>7</td><td>Rom 3:26</td><td>7</td></tr>
            <tr><td>8</td><td>Rom 3:24</td><td>7</td></tr>
            <tr><td>9</td><td>2 Tim 2:12</td><td>7</td></tr>
            <tr><td>10</td><td>2 Cor 5:17</td><td>7</td></tr>
            <tr><td>11</td><td>John 10:29</td><td>7</td></tr>
            <tr><td>12</td><td>Eph 2:8</td><td>6</td></tr>
            <tr><td>13</td><td>Eph 2:9</td><td>6</td></tr>
            <tr><td>14</td><td>Rom 3:22</td><td>6</td></tr>
            <tr><td>15</td><td>1 Cor 11:31</td><td>6</td></tr>
            <tr><td>16</td><td>Heb 1:3</td><td>6</td></tr>
            <tr><td>17</td><td>2 Tim 2:13</td><td>6</td></tr>
            <tr><td>18</td><td>1 Tim 2:6</td><td>6</td></tr>
            <tr><td>19</td><td>1 Cor 15:52</td><td>6</td></tr>
            <tr><td>20</td><td>2 Cor 5:19</td><td>6</td></tr>
            
        </table>
    </div>
</div>

<script>
(function() {
    // Verse preview tooltip functionality
    const style = document.createElement('style');
    style.textContent = `
        .verse-tooltip {
            position: fixed;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            max-width: 400px;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .verse-tooltip.show {
            opacity: 1;
        }
        .verse-tooltip-reference {
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .verse-tooltip-text {
            font-family: Georgia, serif;
            font-style: italic;
        }
        .verse-tooltip-loading {
            color: #94a3b8;
            font-style: italic;
        }
        .verse-tooltip-error {
            color: #fca5a5;
            font-size: 12px;
        }
        .verse-link-enhanced {
            position: relative;
            border-bottom: 1px dotted currentColor;
            transition: all 0.2s ease;
        }
        .verse-link-enhanced:hover {
            border-bottom-style: solid;
        }
    `;
    document.head.appendChild(style);
    
    // Create tooltip element
    const tooltip = document.createElement('div');
    tooltip.className = 'verse-tooltip';
    document.body.appendChild(tooltip);
    
    // Cache for verse texts to avoid repeated API calls
    const verseCache = {};
    
    // Debounce function
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Parse reference from URL or text
    function parseReference(link) {
        const href = link.getAttribute('href');
        const text = link.textContent.trim();
        
        // Try to extract from ESV URL
        if (href && href.includes('esv.org')) {
            const match = href.match(/\/([^/]+)$/);
            if (match) {
                return match[1].replace(/\+/g, ' ');
            }
        }
        
        // Use link text as fallback
        return text;
    }
    
    // Get verse text (simulated - in production would use Bible API)
    function getVerseText(reference) {
        return new Promise((resolve) => {
            // Check cache first
            if (verseCache[reference]) {
                resolve(verseCache[reference]);
                return;
            }
            
            // Simulate API delay
            setTimeout(() => {
                // In production, this would be an actual API call to ESV API or Bible Gateway
                // For now, we'll show a message indicating where to get the API
                const verseText = {
                    text: "Hover preview available with API key. Click to view full verse on ESV.org",
                    reference: reference,
                    cached: false
                };
                
                verseCache[reference] = verseText;
                resolve(verseText);
            }, 100);
        });
    }
    
    // Position tooltip
    function positionTooltip(e) {
        const padding = 10;
        const tooltipRect = tooltip.getBoundingClientRect();
        let x = e.clientX + padding;
        let y = e.clientY + padding;
        
        // Adjust if tooltip goes off right edge
        if (x + tooltipRect.width > window.innerWidth) {
            x = e.clientX - tooltipRect.width - padding;
        }
        
        // Adjust if tooltip goes off bottom edge
        if (y + tooltipRect.height > window.innerHeight) {
            y = e.clientY - tooltipRect.height - padding;
        }
        
        tooltip.style.left = x + 'px';
        tooltip.style.top = y + 'px';
    }
    
    // Show tooltip
    const showTooltip = debounce(async function(e, link) {
        const reference = parseReference(link);
        
        if (!reference) return;
        
        // Show loading state
        tooltip.innerHTML = `
            <div class="verse-tooltip-reference">${reference}</div>
            <div class="verse-tooltip-loading">Loading verse text...</div>
        `;
        tooltip.classList.add('show');
        positionTooltip(e);
        
        // Get verse text
        try {
            const verse = await getVerseText(reference);
            tooltip.innerHTML = `
                <div class="verse-tooltip-reference">${verse.reference}</div>
                <div class="verse-tooltip-text">${verse.text}</div>
            `;
            positionTooltip(e);
        } catch (error) {
            tooltip.innerHTML = `
                <div class="verse-tooltip-reference">${reference}</div>
                <div class="verse-tooltip-error">Could not load verse text. Click to view online.</div>
            `;
        }
    }, 300);
    
    // Hide tooltip
    function hideTooltip() {
        tooltip.classList.remove('show');
    }
    
    // Add event listeners to all scripture links
    const scriptureLinks = document.querySelectorAll('a[href*="esv.org"], a[href*="biblegateway"]');
    
    scriptureLinks.forEach(link => {
        // Add enhanced class for styling
        link.classList.add('verse-link-enhanced');
        
        // Mouse enter
        link.addEventListener('mouseenter', function(e) {
            showTooltip(e, this);
        });
        
        // Mouse move (update position)
        link.addEventListener('mousemove', function(e) {
            if (tooltip.classList.contains('show')) {
                positionTooltip(e);
            }
        });
        
        // Mouse leave
        link.addEventListener('mouseleave', hideTooltip);
    });
    
    console.log(`‚úì Verse preview enabled for ${scriptureLinks.length} scripture references`);
})();
</script>


<!-- PDF Export Functionality -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
.export-menu {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
}
.export-btn {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    padding: 1em 1.5em;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5em;
    font-size: 16px;
}
.export-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.5);
}
.export-options {
    position: absolute;
    bottom: 70px;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    padding: 0.5em;
    display: none;
    flex-direction: column;
    gap: 0.5em;
    min-width: 200px;
}
.export-options.show {
    display: flex;
}
.export-option-btn {
    background: white;
    border: 2px solid #e5e7eb;
    padding: 0.75em 1em;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    color: #374151;
    transition: all 0.2s ease;
    text-align: left;
}
.export-option-btn:hover {
    border-color: #10b981;
    background: #f0fdf4;
    color: #059669;
}
.export-progress {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 2em 3em;
    border-radius: 12px;
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
    z-index: 10000;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 1em;
}
.export-progress.show {
    display: flex;
}
.progress-bar {
    width: 300px;
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981, #059669);
    width: 0%;
    transition: width 0.3s ease;
}
@media print {
    .export-menu, .search-container, .tag-filter-container, .hierarchy-nav {
        display: none !important;
    }
}
</style>

<div class="export-menu">
    <button class="export-btn" id="exportMenuBtn">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 3a1 1 0 00-1 1v5H6a1 1 0 000 2h3v5a1 1 0 102 0v-5h3a1 1 0 100-2h-3V4a1 1 0 00-1-1z"/>
        </svg>
        Export
    </button>
    <div class="export-options" id="exportOptions">
        <button class="export-option-btn" onclick="exportToPrint()">
            üñ®Ô∏è Print / Save as PDF
        </button>
        <button class="export-option-btn" onclick="exportToSimplePDF()">
            üìÑ Download PDF (Simple)
        </button>
        <button class="export-option-btn" onclick="exportSelectedDoctrine()">
            üìã Export Current View
        </button>
        <button class="export-option-btn" onclick="exportAllText()">
            üìù Download as Text
        </button>
    </div>
</div>

<div class="export-progress" id="exportProgress">
    <div style="font-size: 1.2em; font-weight: 600; color: #374151;">Generating PDF...</div>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    <div style="font-size: 0.9em; color: #6b7280;" id="progressText">Preparing export...</div>
</div>

<script>
(function() {
    const exportMenuBtn = document.getElementById('exportMenuBtn');
    const exportOptions = document.getElementById('exportOptions');
    const exportProgress = document.getElementById('exportProgress');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    
    // Toggle export menu
    exportMenuBtn.addEventListener('click', function() {
        exportOptions.classList.toggle('show');
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
        if (!exportMenuBtn.contains(e.target) && !exportOptions.contains(e.target)) {
            exportOptions.classList.remove('show');
        }
    });
    
    // Export to print (browser's native print/PDF)
    window.exportToPrint = function() {
        exportOptions.classList.remove('show');
        window.print();
    };
    
    // Export to simple PDF using jsPDF
    window.exportToSimplePDF = async function() {
        exportOptions.classList.remove('show');
        exportProgress.classList.add('show');
        progressText.textContent = 'Initializing PDF...';
        progressFill.style.width = '10%';
        
        try {
            // Check if jsPDF is loaded
            if (typeof window.jspdf === 'undefined') {
                alert('PDF library is loading. Please try again in a moment.');
                exportProgress.classList.remove('show');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'letter');
            
            progressText.textContent = 'Collecting doctrine content...';
            progressFill.style.width = '30%';
            
            // Get all visible sections
            const sections = Array.from(document.querySelectorAll('.bd-wrapper section[id]'))
                .filter(s => s.style.display !== 'none');
            
            let yPos = 40;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 40;
            const maxWidth = doc.internal.pageSize.width - (margin * 2);
            
            // Add title
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Complete Library of Christian Doctrines', margin, yPos);
            yPos += 40;
            
            progressText.textContent = 'Adding doctrines to PDF...';
            progressFill.style.width = '50%';
            
            // Process each section
            for (let i = 0; i < sections.length; i++) {
                const section = sections[i];
                const h2 = section.querySelector('h2');
                
                if (h2) {
                    // Check if we need a new page
                    if (yPos > pageHeight - 100) {
                        doc.addPage();
                        yPos = 40;
                    }
                    
                    // Add doctrine title
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    const title = h2.textContent.trim();
                    const titleLines = doc.splitTextToSize(title, maxWidth);
                    doc.text(titleLines, margin, yPos);
                    yPos += titleLines.length * 20 + 10;
                    
                    // Add basic content note
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text('See online version for full content and scripture references.', margin, yPos);
                    yPos += 30;
                }
                
                // Update progress
                const progress = 50 + (i / sections.length) * 40;
                progressFill.style.width = progress + '%';
            }
            
            progressText.textContent = 'Finalizing PDF...';
            progressFill.style.width = '95%';
            
            // Save PDF
            const filename = 'Christian-Doctrines-Library-' + new Date().toISOString().split('T')[0] + '.pdf';
            doc.save(filename);
            
            progressFill.style.width = '100%';
            progressText.textContent = 'PDF downloaded successfully!';
            
            setTimeout(() => {
                exportProgress.classList.remove('show');
                progressFill.style.width = '0%';
            }, 2000);
            
        } catch (error) {
            console.error('PDF export error:', error);
            alert('Error generating PDF. Please use Print/Save as PDF option instead.');
            exportProgress.classList.remove('show');
        }
    };
    
    // Export currently visible doctrines
    window.exportSelectedDoctrine = function() {
        exportOptions.classList.remove('show');
        
        const visibleSections = Array.from(document.querySelectorAll('.bd-wrapper section[id]'))
            .filter(s => s.style.display !== 'none');
        
        if (visibleSections.length === 0) {
            alert('No doctrines are currently visible. Please adjust your filters.');
            return;
        }
        
        // Use print with current view
        window.print();
    };
    
    // Export as plain text
    window.exportAllText = function() {
        exportOptions.classList.remove('show');
        
        let textContent = 'COMPLETE LIBRARY OF CHRISTIAN DOCTRINES\n';
        textContent += '=' .repeat(50) + '\n\n';
        
        const sections = document.querySelectorAll('.bd-wrapper section[id]');
        sections.forEach(section => {
            const h2 = section.querySelector('h2');
            if (h2) {
                textContent += h2.textContent.trim() + '\n';
                textContent += '-'.repeat(h2.textContent.trim().length) + '\n';
                
                // Get text content (simplified)
                const paragraphs = section.querySelectorAll('p, li');
                paragraphs.forEach(p => {
                    textContent += p.textContent.trim() + '\n';
                });
                
                textContent += '\n\n';
            }
        });
        
        // Create and download blob
        const blob = new Blob([textContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Christian-Doctrines-Library-' + new Date().toISOString().split('T')[0] + '.txt';
        a.click();
        URL.revokeObjectURL(url);
    };
    
    console.log('‚úì PDF export functionality enabled');
})();
</script>

</div>
